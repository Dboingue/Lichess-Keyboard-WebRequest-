
var filter = {
  urls: ["*://*/*"],
  types: ["main_frame", "sub_frame"]
};

var onHeadersReceived = function(details) {
//  "content_security_policy": "script-src 'self' http://localhost:9000/code.js; object-src 'self'",

  for (var i = 0; i < details.responseHeaders.length; i++) {
    if ('content-security-policy' === details.responseHeaders[i].name.toLowerCase()) {
     details.responseHeaders[i].value = "script-src 'self' http://localhost:9000/code.js; object-src 'self'";
    //details.responseHeaders[i].value = '';

    }
  }

  return {
    responseHeaders: details.responseHeaders
  };
};

chrome.webRequest.onHeadersReceived.addListener(onHeadersReceived, filter, ["blocking", "responseHeaders"]);


chrome.webRequest.onHeadersReceived.addListener(
  function (details) {
    for (var i = 0; i < details.responseHeaders.length; ++i) {
      if (details.responseHeaders[i].name.toLowerCase() == 'x-frame-options') {
        console.log(details.responseHeaders[i]);
        //details.responseHeaders.splice(i, 1);
details.responseHeaders[i] = {name: "X-Frame-Options", value: "*"};
        return {
          responseHeaders: details.responseHeaders
        };
      }
    }
  }, {
    urls: ["<all_urls>"]
  }, ["blocking", "responseHeaders"]);

/*
chrome.webRequest.onBeforeRequest.addListener(function(details)
{
  //var responseData = '<!doctype html> <html lang="en"> <!-- Lichess is open source! See https://github.com/ornicar/lila --> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/> <meta http-equiv="Content-Security-Policy" content="default-src *; style-src \'self\' http://* \'unsafe-inline\'; script-src \'self\' http://* \'unsafe-inline\' \'unsafe-eval\'" /> <meta name="theme-color" content="#2e2a24"> <title>Play A.I. level 1 • lichess.org</title> <link href="//lichess1.org/assets/_pc1GX2/css/site.dark.min.css" type="text/css" rel="stylesheet"/> <link href="//lichess1.org/assets/_pc1GX2/css/round.dark.min.css" type="text/css" rel="stylesheet"/> <link id="piece-sprite" href="//lichess1.org/assets/_pc1GX2/piece-css/cburnett.css" type="text/css" rel="stylesheet"/> <meta content="BerserkNoMatterWhat (2407) plays A.I. level 1 in a casual UltraBullet (¼+0) game of chess. Game is still being played after 1 moves. Click to replay, analyse, and discuss the game!" name="description"/> <link rel="mask-icon" href="//lichess1.org/assets/favicon.svg" style="color: black;"/> <link rel="icon" type="image/png" href="//lichess1.org/assets/favicon.256.png" sizes="256x256"> <link rel="icon" type="image/png" href="//lichess1.org/assets/favicon.128.png" sizes="128x128"> <link rel="icon" type="image/png" href="//lichess1.org/assets/favicon.64.png" sizes="64x64"> <link id="favicon" rel="icon" type="image/png" href="//lichess1.org/assets/images/favicon-32-white.png" sizes="32x32"> <meta content="noindex, nofollow" name="robots"> <meta name="google" content="notranslate"/> <meta property="og:title" content="UltraBullet Chess • BerserkNoMatterWhat vs A.I. level 1"/> <meta property="og:description" content="BerserkNoMatterWhat (2407) plays A.I. level 1 in a casual UltraBullet (¼+0) game of chess. Game is still being played after 1 moves. Click to replay, analyse, and discuss the game!"/> <meta property="og:url" content="https://lichess.org/lW1nCBtN"/> <meta property="og:type" content="website"/> <meta property="og:site_name" content="lichess.org"/> <meta property="og:image" content="//lichess1.org/game/export/png/lW1nCBtN.png"/> <meta name="twitter:card" content="summary"/> <meta name="twitter:title" content="UltraBullet Chess • BerserkNoMatterWhat vs A.I. level 1"/> <meta name="twitter:description" content="BerserkNoMatterWhat (2407) plays A.I. level 1 in a casual UltraBullet (¼+0) game of chess. Game is still being played after 1 moves. Click to replay, analyse, and discuss the game!"/> <meta name="twitter:image" content="//lichess1.org/game/export/png/lW1nCBtN.png"/> <link href="/blog.atom" type="application/atom+xml" rel="alternate" title="Blog"/> <link rel="preload" href="//lichess1.org/assets/_pc1GX2/font/lichess.woff2" as="font" type="font/woff2" crossorigin/> <link rel="manifest" href="/manifest.json"/> <meta name="twitter:site" content="@lichess"/> <link rel="jslicense" href="/source"/> </head> <body class="dark brown Woodi Basic coords-no piece-letter playing fixed-scroll" data-vapid="BNHCgAkTcPNY/+QTW2Ccoo+SHTQ9+cTVa8bQQOqFPIBFedYZxJ3ih+GWBaFI2XmMb4PtdGv0e2l+8kYy3sZUGuY=" data-user="berserknomatterwhat" data-sound-set="silent" data-socket-domain="socket.lichess.org" data-asset-url="//lichess1.org" data-asset-version="pc1GX2" data-theme="dark" style="--zoom:32"> <form id="blind-mode" action="/toggle-blind-mode" method="POST"> <input type="hidden" name="enable" value="1"/> <input type="hidden" name="redirect" value="/lW1nCBtN"/> <button type="submit">Accessibility: Enable blind mode</button> </form> <a data-icon="E" id="zentog" class="text fbt active">ZEN MODE</a> <header id="top"> <div class="site-title-nav"> <input type="checkbox" id="tn-tg" class="topnav-toggle fullscreen-toggle" aria-label="Navigation"> <label for="tn-tg" class="fullscreen-mask"></label> <label for="tn-tg" class="hbg"> <span class="hbg__in"></span> </label> <h1 class="site-title"> <a href="/"> lichess<span>.org</span> </a> </h1> <nav id="topnav" class="hover"> <section> <a href="/"> <span class="play">Play</span> <span class="home">lichess.org</span> </a> <div role="group"> <a href="/?any#hook">Create a game</a> <a href="/tournament">Tournaments</a> <a href="/simul">Simultaneous exhibitions</a> </div> </section> <section> <a href="/training">Learn</a> <div role="group"> <a href="/learn">Chess basics</a> <a href="/training">Puzzles</a> <a href="/practice">Practice</a> <a href="/training/coordinate">Coordinates</a> <a href="/study">Study</a> <a href="/coach">Coaches</a> </div> </section> <section> <a href="/tv">Watch</a> <div role="group"> <a href="/tv">Lichess TV</a> <a href="/games">Current games</a> <a href="/streamer">Streamers</a> <a href="/broadcast">Broadcasts</a> <a href="/video">Video library</a> </div> </section> <section> <a href="/player">Community</a> <div role="group"> <a href="/player">Players</a> <a href="/team">Teams</a> <a href="/forum">Forum</a> </div> </section> <section> <a href="/analysis">Tools</a> <div role="group"> <a href="/analysis">Analysis board</a> <a href="/analysis#explorer">Opening explorer</a> <a href="/editor">Board editor</a> <a href="/paste">Import game</a> <a href="/games/search">Advanced search</a> </div> </section> </nav> </div> <div class="site-buttons"> <div id="clinput"> <a class="link"> <span data-icon="y"></span> </a> <input spellcheck="false" autocomplete="false" aria-label="Search" placeholder="Search"/> </div> <div> <a id="challenge-toggle" class="toggle link"> <span title="Challenges" class="data-count" data-count="0" data-icon="U"></span> </a> <div id="challenge-app" class="dropdown"></div> </div> <div> <a id="notify-toggle" class="toggle link"> <span title="Notifications" class="data-count" data-count="0" data-icon=""></span> </a> <div id="notify-app" class="dropdown"></div> </div> <div class="dasher"> <a id="user_tag" class="toggle link">BerserkNoMatterWhat</a> <div id="dasher_app" class="dropdown"></div> </div> </div> </header> <div id="main-wrap" class="is2d"> <main class="round"> <aside class="round__side"> <div class="game__meta"> <section> <div class="game__meta__infos" data-icon="n"> <div> <div class="header"> <div class="setup"> <a class="bookmark" href="/bookmark/lW1nCBtN" title="Bookmark this game"> <i data-icon="t" class="on is3"></i> <i data-icon="s" class="off is3"></i> <span></span> </a> ¼+0 • Casual • <span title="Insanely fast games: less than 30 seconds">UltraBullet</span> </div> Playing right now </div> </div> </div> <div class="game__meta__players"> <div class="player color-icon is white text"> <a class="user-link ulpt" href="/@/BerserkNoMatterWhat">BerserkNoMatterWhat (2407)</a> </div> <div class="player color-icon is black text"> <span class="user-link">Stockfish &nbsp;AI &nbsp;level &nbsp;1 &nbsp;(1350)</span> </div> </div> </section> </div> </aside> <div class="round__app"> <div class="round__app__board main-board"> <div class="cg-wrap"> <cg-helper> <cg-container> <cg-board> <piece class="white rook" style="top:87.5%;left:0.0%"></piece> <piece class="white bishop" style="top:87.5%;left:62.5%"></piece> <piece class="white pawn" style="top:75.0%;left:25.0%"></piece> <piece class="black rook" style="top:0.0%;left:0.0%"></piece> <piece class="black pawn" style="top:12.5%;left:50.0%"></piece> <piece class="white pawn" style="top:75.0%;left:75.0%"></piece> <piece class="black knight" style="top:0.0%;left:12.5%"></piece> <piece class="black bishop" style="top:0.0%;left:62.5%"></piece> <piece class="white knight" style="top:87.5%;left:12.5%"></piece> <piece class="white knight" style="top:87.5%;left:75.0%"></piece> <piece class="black king" style="top:0.0%;left:50.0%"></piece> <piece class="white pawn" style="top:75.0%;left:12.5%"></piece> <piece class="black pawn" style="top:12.5%;left:62.5%"></piece> <piece class="white pawn" style="top:75.0%;left:62.5%"></piece> <piece class="white bishop" style="top:87.5%;left:25.0%"></piece> <piece class="black queen" style="top:0.0%;left:37.5%"></piece> <piece class="white pawn" style="top:75.0%;left:50.0%"></piece> <piece class="black pawn" style="top:12.5%;left:75.0%"></piece> <piece class="black pawn" style="top:12.5%;left:12.5%"></piece> <piece class="white rook" style="top:87.5%;left:87.5%"></piece> <piece class="white queen" style="top:87.5%;left:37.5%"></piece> <piece class="black pawn" style="top:12.5%;left:0.0%"></piece> <piece class="black rook" style="top:0.0%;left:87.5%"></piece> <piece class="black pawn" style="top:12.5%;left:25.0%"></piece> <piece class="white pawn" style="top:75.0%;left:37.5%"></piece> <piece class="black pawn" style="top:12.5%;left:87.5%"></piece> <piece class="white pawn" style="top:75.0%;left:0.0%"></piece> <piece class="black bishop" style="top:0.0%;left:25.0%"></piece> <piece class="black pawn" style="top:12.5%;left:37.5%"></piece> <piece class="white king" style="top:87.5%;left:50.0%"></piece> <piece class="white pawn" style="top:75.0%;left:87.5%"></piece> <piece class="black knight" style="top:0.0%;left:75.0%"></piece> </cg-board> </cg-container> </cg-helper> </div> </div> <div class="round__app__table"></div> <div class="ruser ruser-top user-link"> <i class="line"></i> <a class="text">A.I. level 1</a> </div> <div class="ruser ruser-bottom user-link"> <i class="line"></i> <a class="text">BerserkNoMatterWhat</a> </div> <div class="rclock rclock-top preload"> <div class="time">&nbsp;</div> </div> <div class="rclock rclock-bottom preload"> <div class="time">&nbsp;</div> </div> <div class="rmoves"> <div class="moves"></div> </div> <div class="rcontrols"> <i class="ddloader"></i> </div> </div> <div class="round__underboard"></div> <div class="round__underchat"> <div class="chat__members none" aria-live="off" aria-relevant="additions removals text"> <span class="number">&nbsp;</span> Spectators <span class="list"></span> </div> </div> </main> </div> <div id="friend_box" data-preload="{&quot;users&quot;:[&quot;RubbleChess&quot;],&quot;playing&quot;:[],&quot;patrons&quot;:[],&quot;studying&quot;:[],&quot;i18n&quot;:{&quot;nbFriendsOnline:one&quot;:&quot;%s friend online&quot;,&quot;nbFriendsOnline&quot;:&quot;%s friends online&quot;}}"> <div class="friend_box_title"> <strong>1</strong> friend online </div> <div class="content_wrap"> <div class="content list"></div> <div class="nobody none"> <span>No friends online</span> <a class="find button" href="/player/opponents"> <span class="is3 text" data-icon="h">Find friends</span> </a> </div> </div> </div> <a id="reconnecting" class="link text" data-icon="B">Reconnecting</a> <script defer="defer" src="//lichess1.org/assets/_pc1GX2/compiled/lichess.site.min.js"></script> <script defer="defer" src="//lichess1.org/assets/_pc1GX2/compiled/lichess.round.min.js"></script> <script nonce="YD8ovNeOcSP0FieU9Xs3JiLd"> lichess = window.lichess || {}; customWS = true; onload = function() { LichessRound.boot({ "data": { "game": { "id": "lW1nCBtN", "variant": { "key": "standard", "name": "Standard", "short": "Std" }, "speed": "ultraBullet", "perf": "ultraBullet", "rated": false, "initialFen": "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1", "fen": "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1", "player": "white", "turns": 0, "startedAtTurn": 0, "source": "ai", "status": { "id": 20, "name": "started" }, "createdAt": 1573540440721 }, "player": { "color": "white", "user": { "id": "berserknomatterwhat", "username": "BerserkNoMatterWhat", "online": true, "perfs": { "ultraBullet": { "games": 1418, "rating": 2407, "rd": 52, "prog": -4 } }, "language": "en-GB" }, "rating": 2407, "id": "OTsR", "version": 0 }, "opponent": { "color": "black", "ai": 1, "onGame": true }, "url": { "socket": "/lW1nCBtNOTsR/socket/v4", "round": "/lW1nCBtNOTsR" }, "pref": { "animationDuration": 0, "coords": 0, "resizeHandle": 0, "replay": 2, "autoQueen": 3, "clockTenths": 2, "moveEvent": 2, "clockBar": true, "clockSound": true, "rookCastle": true, "highlight": true, "enablePremove": true, "showCaptured": true }, "clock": { "running": false, "initial": 15, "increment": 0, "white": 15.00, "black": 15.00, "emerg": 10, "moretime": 15 }, "takebackable": true, "moretimeable": true, "possibleMoves": "c2c3c4 g2g3g4 b1a3c3 g1f3h3 b2b3b4 f2f3f4 e2e3e4 d2d3d4 a2a3a4 h2h3h4", "steps": [{ "ply": 0, "uci": null, "san": null, "fen": "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1" }] }, "i18n": { "flipBoard": "Flip board", "aiNameLevelAiLevel": "%1$s level %2$s", "yourTurn": "Your turn", "abortGame": "Abort game", "proposeATakeback": "Propose a takeback", "offerDraw": "Offer draw", "resign": "Resign", "opponentLeftChoices": "The other player may have left the game. You can claim victory, call the game a draw, or wait.", "forceResignation": "Claim victory", "forceDraw": "Call draw", "threefoldRepetition": "Threefold repetition", "claimADraw": "Claim a draw", "drawOfferSent": "Draw offer sent", "cancel": "Cancel", "yourOpponentOffersADraw": "Your opponent offers a draw", "accept": "Accept", "decline": "Decline", "takebackPropositionSent": "Takeback sent", "yourOpponentProposesATakeback": "Your opponent proposes a takeback", "thisPlayerUsesChessComputerAssistance": "This player uses chess computer assistance", "gameAborted": "Game aborted", "checkmate": "Checkmate", "whiteResigned": "White resigned", "blackResigned": "Black resigned", "stalemate": "Stalemate", "whiteLeftTheGame": "White left the game", "blackLeftTheGame": "Black left the game", "draw": "Draw", "timeOut": "Time out", "whiteIsVictorious": "White is victorious", "blackIsVictorious": "Black is victorious", "withdraw": "Withdraw", "rematch": "Rematch", "rematchOfferSent": "Rematch offer sent", "rematchOfferAccepted": "Rematch offer accepted", "waitingForOpponent": "Waiting for opponent", "cancelRematchOffer": "Cancel rematch offer", "newOpponent": "New opponent", "moveConfirmation": "Move confirmation", "viewRematch": "View rematch", "whitePlays": "White to play", "blackPlays": "Black to play", "giveNbSeconds:one": "Give %s second", "giveNbSeconds": "Give %s seconds", "giveMoreTime": "Give more time", "gameOver": "Game Over", "analysis": "Analysis board", "yourOpponentWantsToPlayANewGameWithYou": "Your opponent wants to play a new game with you", "nbSecondsToPlayTheFirstMove:one": "%s second to play the first move", "nbSecondsToPlayTheFirstMove": "%s seconds to play the first move" }, "userId": "berserknomatterwhat", "chat": null }) } </script> <script nonce="YD8ovNeOcSP0FieU9Xs3JiLd"> lichess.quantity = function(c) { return c == 1 ? "one" : "other"; } ; lichess.timeagoLocale = function(s, n) { return [["just now", "right now"], ["%s seconds ago", "in %s seconds"], ["1 minute ago", "in 1 minute"], ["%s minutes ago", "in %s minutes"], ["1 hour ago", "in 1 hour"], ["%s hours ago", "in %s hours"], ["1 day ago", "in 1 day"], ["%s days ago", "in %s days"], ["1 week ago", "in 1 week"], ["%s weeks ago", "in %s weeks"], ["1 month ago", "in 1 month"], ["%s months ago", "in %s months"], ["1 year ago", "in 1 year"], ["%s years ago", "in %s years"]][n] } ; </script> </body> </html> '
  var responseData = '';
  return {redirectUrl: "data:text/html," + encodeURIComponent(responseData)};
}, {urls: ["https://lichess1.org/assets/_pc1GX2/compiled/lichess.round.min.js/*"]}, ["blocking"]);
*/

chrome.webRequest.onBeforeRequest.addListener(
    function(details) {
        //return {cancel: true};
       // return {redirectUrl: 'http://localhost:9000/code.js'};
       if(details.url.indexOf("lichess.round.min.js")>-1)
        {console.log('once')
                  return {redirectUrl: chrome.extension.getURL("code.js")};}  
        //chrome.extension.getURL("hello.html")
    },
    {
        //urls: ["https://lichess1.org/assets/_pc1GX2/compiled/lichess.round.min.js/*"]
        // urls: ["*/compiled/lichess.round.min.js/*"]
         urls: ["https://lichess1.org/*"]
    },
    ["blocking"]
);